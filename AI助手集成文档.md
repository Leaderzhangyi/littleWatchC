# 智能刷课助手集成AI助手功能文档

## 1. 集成目标与范围

### 1.1 集成目标
在现有智能刷课助手中添加AI助手功能，实现用户通过自然语言指令控制刷课任务，无需手动填写表单。

### 1.2 集成范围
- **前端**：添加AI聊天界面，支持用户输入自然语言指令
- **后端**：集成LangChain框架，构建AI Agent，解析用户指令并调用现有刷课API
- **功能**：
  - 支持用户通过自然语言输入cookies、token
  - 支持用户指定章节和小节（如"第3章第5小节"）
  - 自动解析用户指令，生成刷课任务
  - 执行刷课任务并返回结果

## 2. 环境配置要求

### 2.1 硬件要求
- CPU：4核以上
- 内存：8GB以上
- 磁盘空间：20GB以上

### 2.2 软件要求
- Python 3.8+ 
- Node.js 16+（如使用前端框架）

### 2.3 依赖库
```
fastapi==0.110.0
uvicorn==0.29.0
langchain==0.1.15
langchain-openai==0.1.0
requests==2.31.0
beautifulsoup4==4.12.3
python-dotenv==1.0.1
flask==3.0.3
flask-cors==4.0.1
flask-socketio==5.3.6
python-socketio==5.11.2
python-engineio==4.8.2
uuid==1.30
```

## 3. 集成文件说明

### 3.1 新增文件
1. **`requirements.txt`**：包含所有必要的依赖库
2. **`.env`**：AI模型API Key配置文件
3. **`ai_agent.py`**：AI助手核心模块，实现自然语言指令解析和刷课任务执行
4. **`AI助手集成文档.md`**：本文档

### 3.2 修改文件
1. **`app.py`**：添加AI助手API接口
2. **`index.html`**：添加AI聊天界面和相关JavaScript函数

## 4. 具体集成步骤

### 4.1 前置条件
- 现有智能刷课助手项目已正常运行
- 已申请OpenAI API Key或其他AI模型API Key
- 已安装Python 3.8+和pip

### 4.2 安装依赖库
```bash
pip install -r requirements.txt
```

### 4.3 配置AI模型API Key
编辑`.env`文件，添加您的OpenAI API Key：
```
OPENAI_API_KEY=your_openai_api_key
```

### 4.4 启动服务器
```bash
python app.py
```

### 4.5 访问前端页面
在浏览器中访问：
```
http://localhost:5000
```

## 5. 功能使用说明

### 5.1 AI助手界面
- 页面中间新增了AI助手聊天区域
- 底部文本框用于输入自然语言指令
- 右侧显示聊天历史记录

### 5.2 自然语言指令示例

#### 5.2.1 完整指令
```
使用cookies 'your_cookies_here'和token 'your_token_here'学习课程123456的第3章第5小节
```

#### 5.2.2 部分指令（AI会询问缺失信息）
```
学习课程123456的第3章第5小节
```

#### 5.2.3 多章节小节
```
使用cookies 'your_cookies_here'和token 'your_token_here'学习课程123456的第2-5章第1-3小节
```

### 5.3 响应示例
- 成功响应：`已开始刷课任务，课程ID: 123456，章节范围: {"start": 3, "end": 3}，小节范围: {"start": 5, "end": 5}`
- 失败响应：`请提供以下信息：cookies, token`

## 6. API接口说明

### 6.1 AI助手API
- **URL**：`/api/ai-assistant`
- **方法**：POST
- **请求体**：
  ```json
  {
    "query": "使用cookies 'xxx'和token 'yyy'学习课程123的第3章第5小节"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "response": "已开始刷课任务，课程ID: 123，章节范围: {\"start\": 3, \"end\": 3}，小节范围: {\"start\": 5, \"end\": 5}"
  }
  ```

## 7. 关键模块设计

### 7.1 AI Agent模块（ai_agent.py）
- **AIAssistant类**：AI助手核心类，处理用户指令和执行刷课任务
- **extract_info_from_query**：从用户查询中提取关键信息
- **brush_course**：执行刷课任务的核心方法
- **handle_query**：处理用户查询的入口方法

### 7.2 指令解析流程
1. 用户输入自然语言指令
2. AI模型提取关键信息（cookies、token、课程ID、章节范围、小节范围）
3. 检查是否缺少信息，如缺少则询问用户
4. 如信息完整，调用刷课API执行任务
5. 返回执行结果

## 8. 可能遇到的问题及解决方案

### 8.1 AI模型API调用失败
- **问题**：API Key无效或网络问题
- **解决方案**：
  - 检查API Key是否正确
  - 检查网络连接
  - 查看API调用配额

### 8.2 自然语言指令解析失败
- **问题**：用户指令格式不清晰
- **解决方案**：
  - 优化提示词（修改ai_agent.py中的prompt_template）
  - 添加用户指令示例
  - 实现指令验证和纠错功能

### 8.3 刷课API调用失败
- **问题**：cookies或token无效
- **解决方案**：
  - 检查cookies和token格式
  - 实现身份验证预检功能
  - 提供详细的错误提示

## 9. 测试验证方法

### 9.1 单元测试
- 测试AI Agent的指令解析功能
- 测试工具调用功能
- 测试错误处理机制

### 9.2 集成测试
- 测试前端与后端的通信
- 测试完整的刷课流程
- 测试各种边界情况

### 9.3 验收测试
- 模拟真实用户场景
- 测试各种自然语言指令
- 验证刷课结果的准确性

## 10. 集成后的维护注意事项

### 10.1 API Key管理
- 定期更新API Key
- 监控API调用情况，防止滥用
- 考虑使用API网关管理API调用

### 10.2 AI模型更新
- 关注AI模型的更新和优化
- 定期测试模型性能
- 考虑使用模型版本管理

### 10.3 日志管理
- 完善日志记录，便于问题排查
- 定期清理日志文件
- 考虑使用日志分析工具

### 10.4 性能优化
- 监控系统性能，特别是AI模型调用延迟
- 考虑添加缓存机制
- 优化数据库查询

## 11. 后续扩展建议

### 11.1 功能扩展
- 添加多语言支持
- 实现更复杂的指令解析
- 支持用户自定义刷课策略
- 添加刷课进度查询功能

### 11.2 技术扩展
- 集成更多AI模型（如Anthropic Claude、Google Gemini等）
- 实现本地AI模型部署
- 添加RAG（检索增强生成）功能，整合外部知识库
- 实现AI Agent的记忆功能，记住用户偏好

## 12. 总结

通过集成AI助手功能，智能刷课助手变得更加智能化和用户友好。用户可以通过自然语言指令控制刷课任务，无需手动填写复杂的表单，大大提高了使用便捷性。

该集成方案采用了模块化设计，便于后续扩展和维护。同时，提供了详细的文档和使用说明，方便用户快速上手和使用。

未来可以根据用户反馈和需求，进一步优化AI模型的指令解析能力，扩展更多实用功能，提升整体用户体验。
